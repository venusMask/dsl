# 就诊信息	患者是否参与临床试验	从DWD【临床试验】栏目取值：

1、字段（临床试验类型）= GCP
2、字段（临床试验存在状态）= 确定

从DWS【就诊信息】业务表单取值：
就诊科室在临床试验科室词表内 -> 就诊科室过词表映射为NULL
3、字段（就诊科室） = 《临床试验科室》<词表，I期临床试验病区、I期临床试验研究室 等>

当满足（1 + 2）or 3 时，该字段输出“是”

其他则该字段输出“否”
	DWD【临床试验】
DWS【就诊信息】字段（就诊科室）


Medical_Information "患者是否参与临床试验"
r1 ${临床试验类型} = "GCP"
r2 ${临床试验存在状态} = "确定"
r3 ${就诊科室} -> [Dict] != null
满足 (r1 and r2) or r3 输出 "是"
其他输出 "否"



Question:
q1: 字典?
q2: 上游信息包含栏目信息嘛?



# 疾病诊断	患者是否为肺癌	从DWD【患者信息表】栏目取值：
当字段（癌种）= 肺癌，该字段则输出“是”
其他则该字段输出“否”	DWD【患者信息表】

Disease_Diagnosis "患者是否为肺癌"
r1 ${癌种} = "肺癌"
满足 r1 输出 "是"
其他输出 "否"

# 疾病诊断	患者是否为多癌种	从DWD【患者信息表】栏目取值：

当字段（是否多癌种）=是，该字段则输出“是”

当字段（是否多癌种）=否，该字段则输出“否”	DWD【患者信息表】	

Disease_Diagnosis_Multi_Cancer "患者是否为多癌种"
r1 ${是否多癌种} = "是"
满足 r1 输出 "是"
其他输出 "否"


# 疾病诊断	当次就诊在院诊断是否为肺癌	从DWD【疾病诊断】栏目取值：
【疾病诊断】的字段（诊断名称）=《肺癌诊断》<词表，如”肺恶性肿瘤“映射输出”肺癌诊断“> ，
且对应的字段（诊断存在状态）=确定，
且对应的（诊断类型）≠ 出院诊断 <即：入院诊断、其他诊断、未特指、术前诊断、门诊诊断>
该字段输出“是”
其他则该字段输出“否”	DWD【疾病诊断】

Disease_Diagnosis "当次就诊在院诊断是否为肺癌"
r1 ${诊断名称} -> Dict = "肺癌诊断"; ${诊断存在状态} = "确定"; ${诊断类型} != "出院诊断"
满足 r1 输出 "是"
其他输出 "否"


# 手术治疗	当次就诊肺癌手术_最早开始时间	从DWS【手术治疗】业务表单取值：
字段（当次就诊是否行肺癌手术） = 是
当满足时，
从DWD【手术操作】栏目取值：
该字段则输出 min （手术优先级规则时间）或（手术时间）值	DWS【手术治疗】字段（当次就诊是否行肺癌手术）
DWD【手术操作

Rule_Group "当次就诊肺癌手术_最早开始时间"
r1 ${当次就诊是否行肺癌手术} = "是"
满足 r1 输出 min(${手术优先级规则时间})
其他输出 "否"

# 肿瘤分期	当次就诊肺癌手术后90天内是否规范书写pTNM分期	
该字段实现方式分为两部分，
1. 判断是否规范书写了pTNM分期且存在肿瘤分期时间，
2. 肿瘤分期时间是否在“当次就诊肺癌手术_最早开始时间”后90天内，具体规则如下：

1、从DWD【疾病诊断】栏目取值：
①、字段（分期前缀）=“p”或“yp”
②、字段（分期前缀）= “空值” （ 限定b16_2来源表）
③、字段（T分期）=“Tx”或“T0”或“Tis”或“T1”或“T1b”或“T1c”或“T2”或“T2a”或“T3”或“T4”或“T1mi”
④、字段（N分期）=“Nx”或“N0”或“N1”或“N2”或“N3”
⑤、其对应的字段（肿瘤分期时间）≠ null

当满足（① or ②）+③+④+⑤，时，认为书写了pTNM分期且存在肿瘤分期时间

2、从DWD【疾病诊断】栏目取值：
字段（肿瘤分期时间）值 在DWS字段（当次就诊肺癌手术_最早开始时间） 后90天内
即:
（当次就诊肺癌手术_最早开始时间） ＜（肿瘤分期时间）＜（当次就诊肺癌手术_最早开始时间） +91天

当满足 1+2 时，该字段输出“是”

其他则该字段输出“否”	DWD【疾病诊断】
DWS字段（当次就诊肺癌手术_最早开始时间）、（当次就诊肺癌手术_最早开始时间）	

Tumor_Staging "肿瘤分期	当次就诊肺癌手术后90天内是否规范书写pTNM分期"
rule_group_1 "判断是否规范书写了pTNM分期且存在肿瘤分期时间"
r1 ${分期前缀} in {"p", "yp}
r2 ${分期前缀} = "空值"
r3 ${T分期} in {"Tx", "T0", "Tis", "T1", "T1b", "T1c", "T2", "T2a", "T3", "T4", "T1mi"}
r4 ${N分期} in {"Nx", "N0", "N1", "N2", "N3"}
r5 ${肿瘤分期时间} != null
满足 (r1 or r2) and r3 and r4 and r5 输出 "是"
其他输出 "否"

rule_group_2 "肿瘤分期时间是否在“当次就诊肺癌手术_最早开始时间”后90天内"
r1 ${肿瘤分期时间} < min(${当次就诊肺癌手术}) + 91

{
	满足 rule_group_1 and rule_group_2 输出 "是"
	其他输出 "否"
}
